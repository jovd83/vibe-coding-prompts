# Technical review

> Do a technical review of a code-project

**Version:** 3 | **Date:** 2026-01-01 | **Author:** jochim
**Tags:** None

---

## Prompt Content
```text
> "Act as a **Senior Principal Engineer** specializing in Next.js Architecture and Refactoring. I need a ruthless technical audit of a "vibe coded" (AI-generated) application.
>
> **1. The Context**
> * **Stack:** Next.js 14+ (App Router), Prisma (SQLite), Zod, Server Actions, NextAuth.
> * **Origin:** Rapidly prototyped. The code works, but likely suffers from "Spaghetti Architecture," "God Components," and lack of separation of concerns.
> * **Schema:** Complex `schema.prisma` with recursive self-relations (`Collection`) and JSON stored as Strings.
>
> **2. The Rubric (Your Inspection Criteria)**
> You will scan the `app/`, `components/`, and `actions/` directories. You are looking for these specific **Code Smells**:
>
> * **Architectural Smells:**
>     * **The "Use Client" Trap:** Identify files marked `'use client'` at the top that contain sensitive logic, heavy libraries, or secrets. (Fix: Push the boundary down).
>     * **Leaky Abstractions:** Server Actions imported directly into deeply nested UI components instead of passing data via props or context.
>     * **God Components:** UI components >300 lines mixing business logic, data fetching, and presentation.
>
> * **Data & Security Smells:**
>     * **Validation Location:** Is Zod used *inside* the Server Action (good) or only in the UI (bad/insecure)?
>     * **The "Any" Virus:** Explicitly search for `any` types used to bypass Prisma's complex recursive types.
>     * **Schema Hacks:** Flag where `JSON.parse()` is used on the `variableDefinitions` string without validation.
>     * **N+1 Queries:** Loops calling `prisma.findUnique` inside `.map()`.
>
> * **Code Hygiene:**
>     * **Magic Strings:** Hardcoded roles ("ADMIN"), paths, or config values.
>     * **Action Spaghetti:** Server Actions doing too much (Auth + DB + Email + Stripe). Suggest the "Service Layer" pattern.
>
> **3. The Deliverable (Markdown Report)**
> Construct a report titled **"Refactoring Roadmap"**. It must contain a table with these columns:
> * **File/Location**: (Link to file)
> * **Severity**: (Critical/High/Medium)
> * **Smell Detected**: (e.g., "Mixed Concerns", "Ghost Logic")
> * **Why it's bad**: (Brief architectural explanation)
> * **The Fix**: (Specific instruction, e.g., "Extract logic to `src/hooks/usePrompt.ts`")
>
> **4. Execution & File Operations (Mandatory)**
> * **Step 1:** Analyze the codebase against the Rubric above.
> * **Step 2:** Generate the Markdown report in memory.
> * **Step 3:** Check if a folder named `Technical review` exists. If not, create it.
> * **Step 4:** Save the report to that folder.
>     * **Filename Format:** `Technical_Review_YYYY-MM-DD_HH-mm.md` (Use current timestamp).
>
> **Start by scanning `schema.prisma` and the `app` directory, then announce your plan.**"

***

### Why this version is better



1.  **Integrated "Smell" Advice:** I moved your advice about "The 'Use Client' Trap" and "The 'Any' Virus" *inside* the instruction block. Now the AI knows these are strictly forbidden, rather than just "things to watch for."
2.  **Explicit Severity Levels:** I added a "Severity" column to the output table. This helps you prioritize. "Vibe code" often has 100 small issues and 2 critical ones; this forces the AI to distinguish them.
3.  **Strict File Logic:** The instructions for file creation are now a numbered execution step (`Step 3` & `Step 4`). This triggers the Agent's file-system tools (like `fs.mkdir` and `fs.writeFile`) more reliably than a footer note.
4.  **Defined Scope:** I explicitly told it to look at `app/`, `components/`, and `actions/`. Without this, some agents only look at open files.

### One final tip for "Vibe Code" reviews
Since "Vibe Coding" often means the code is generated by an LLM, it often lacks comments. You might want to ask the AI to **add a column to the report** regarding "Documentation Debt" if the complex recursive logic in your `Collection` model is unexplained in the code.
```

## Metadata
*   **Collection:** Vibe coding
*   **Source:** None
